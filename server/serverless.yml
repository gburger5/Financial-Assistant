service: financial-assistant-api
frameworkVersion: '3'

provider:
  name: aws
  runtime: nodejs20.x
  region: us-east-1
  environment:
    JWT_SECRET: ${ssm:/myapp/jwt-secret}
    NODE_ENV: production
    FRONTEND_URL: ${ssm:/myapp/frontend-url}
  iam:
    role:
      statements:
        - Effect: Allow
          Action:
            - ssm:GetParameter
          Resource:
            - "arn:aws:ssm:us-east-1:*:parameter/myapp/jwt-secret"
            - "arn:aws:ssm:us-east-1:*:parameter/myapp/frontend-url"
        - Effect: Allow
          Action:
            - dynamodb:Query
            - dynamodb:PutItem
            - dynamodb:GetItem
            - dynamodb:UpdateItem
          Resource:
            - "arn:aws:dynamodb:us-east-1:*:table/users"
            - "arn:aws:dynamodb:us-east-1:*:table/users/index/email-index"

functions:
  api:
    handler: src/lambda.handler
    events:
      - httpApi:
          path: /{proxy+}
          method: ANY

plugins:
  - serverless-esbuild

custom:
  esbuild:
    bundle: true
    target: node20